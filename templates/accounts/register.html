{% load static %}
<!DOCTYPE html>
<html>
<head>
    <title>Registro</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- React -->
    <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
</head>

<body class="container mt-5">

    <h2 class="text-center mb-4">Crear Cuenta</h2>

    <div id="registerApp"></div>

    {% verbatim %}
    <script type="text/babel">

        function RegisterApp() {
            const [username, setUsername] = React.useState("");
            const [email, setEmail] = React.useState("");
            const [password, setPassword] = React.useState("");
            const [password2, setPassword2] = React.useState("");
            const [error, setError] = React.useState("");
            const [success, setSuccess] = React.useState("");

            function register(e) {
                e.preventDefault();
                setError("");
                setSuccess("");

                fetch("/api/auth/register/", {
                    method: "POST",
                    headers: {"Content-Type": "application/json"},
                    body: JSON.stringify({
                        username,
                        email,
                        password,
                        password2
                    })
                })
                .then(res => res.json())
                .then(data => {
                    if (data.id) {
                        setSuccess("Usuario creado correctamente. Ahora puedes iniciar sesión.");
                        setUsername("");
                        setEmail("");
                        setPassword("");
                        setPassword2("");
                    } else {
                        setError(data.error || "Error al crear usuario.");
                    }
                });
            }

            return (
                <div className="card p-4 shadow-sm" style={{ maxWidth: "400px", margin: "auto" }}>
                    {error && <div className="alert alert-danger">{error}</div>}
                    {success && <div className="alert alert-success">{success}</div>}

                    <form onSubmit={register}>
                        <div className="mb-3">
                            <label>Nombre de usuario</label>
                            <input
                                type="text"
                                value={username}
                                onChange={e => setUsername(e.target.value)}
                                className="form-control"
                                required
                            />
                        </div>

                        <div className="mb-3">
                            <label>Email</label>
                            <input
                                type="email"
                                value={email}
                                onChange={e => setEmail(e.target.value)}
                                className="form-control"
                                required
                            />
                        </div>

                        <div className="mb-3">
                            <label>Contraseña</label>
                            <input
                                type="password"
                                value={password}
                                onChange={e => setPassword(e.target.value)}
                                className="form-control"
                                required
                            />
                        </div>

                        <div className="mb-3">
                            <label>Repetir Contraseña</label>
                            <input
                                type="password"
                                value={password2}
                                onChange={e => setPassword2(e.target.value)}
                                className="form-control"
                                required
                            />
                        </div>

                        <button className="btn btn-primary w-100">Registrarse</button>

                        <div className="text-center mt-3">
                            <a href="/login/">¿Ya tienes cuenta? Inicia sesión</a>
                        </div>
                    </form>
                </div>
            );
        }

        ReactDOM.render(<RegisterApp />, document.getElementById("registerApp"));
    </script>
    {% endverbatim %}
</body>
</html>
