{% load static %}
<!DOCTYPE html>
<html>
<head>
    <title>Login</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- React -->
    <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
</head>

<body class="container mt-5">

    <h2 class="text-center mb-4">Login</h2>

    <div id="loginApp"></div>

    {% verbatim %}
    <script type="text/babel">

        function LoginApp() {
            const [username, setUsername] = React.useState("");
            const [password, setPassword] = React.useState("");
            const [error, setError] = React.useState("");

            function login(e) {
                e.preventDefault();

                fetch("/api/auth/login/", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({ username, password })
                })
                .then(res => res.json())
                .then(data => {
                    if (data.access) {
                        // Guardar tokens JWT
                        localStorage.setItem("access", data.access);
                        localStorage.setItem("refresh", data.refresh);

                        // Redirigir al perfil
                        window.location.href = "/profile/";
                    } else {
                        setError("Credenciales inválidas");
                    }
                });
            }

            return (
                <div className="card p-4 shadow-sm" style={{ maxWidth: "400px", margin: "auto" }}>
                    {error && <div className="alert alert-danger">{error}</div>}

                    <form onSubmit={login}>
                        <div className="mb-3">
                            <label>Usuario</label>
                            <input
                                type="text"
                                className="form-control"
                                value={username}
                                onChange={e => setUsername(e.target.value)}
                                required
                            />
                        </div>

                        <div className="mb-3">
                            <label>Contraseña</label>
                            <input
                                type="password"
                                className="form-control"
                                value={password}
                                onChange={e => setPassword(e.target.value)}
                                required
                            />
                        </div>

                        <button className="btn btn-primary w-100">Ingresar</button>
                    </form>

                    <div className="text-center mt-3">
                        <a href="/register/">¿No tienes cuenta? Regístrate</a>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<LoginApp />, document.getElementById("loginApp"));
    </script>
    {% endverbatim %}

</body>
</html>
